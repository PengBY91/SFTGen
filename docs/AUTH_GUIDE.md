# GraphGen ç”¨æˆ·è®¤è¯ä¸æƒé™ç®¡ç†æŒ‡å—

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [ç”¨æˆ·è§’è‰²](#ç”¨æˆ·è§’è‰²)
- [é»˜è®¤è´¦æˆ·](#é»˜è®¤è´¦æˆ·)
- [åŠŸèƒ½æƒé™](#åŠŸèƒ½æƒé™)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
- [API æ¥å£](#api-æ¥å£)
- [å®‰å…¨è¯´æ˜](#å®‰å…¨è¯´æ˜)

---

## ç³»ç»Ÿæ¦‚è¿°

GraphGen v2.0 å¼•å…¥äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ã€‚ç³»ç»Ÿä½¿ç”¨ JWTï¼ˆJSON Web Tokenï¼‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œç¡®ä¿ API è°ƒç”¨çš„å®‰å…¨æ€§ã€‚

### æŠ€æœ¯æ ˆ

- **åç«¯è®¤è¯**: JWT + SHA256 å¯†ç å“ˆå¸Œ
- **å‰ç«¯çŠ¶æ€ç®¡ç†**: Pinia Store
- **è·¯ç”±å®ˆå«**: Vue Router
- **ä¼šè¯ç®¡ç†**: LocalStorage + Token è‡ªåŠ¨åˆ·æ–°

---

## ç”¨æˆ·è§’è‰²

### 1. ç®¡ç†å‘˜ï¼ˆAdminï¼‰

**æƒé™**ï¼š
- âœ… åˆ›å»ºå’Œç®¡ç†æ•°æ®ç”Ÿæˆä»»åŠ¡
- âœ… é…ç½®ç³»ç»Ÿå‚æ•°
- âœ… ä¸Šä¼ æ•°æ®æ–‡ä»¶
- âœ… å®¡æ ¸ç”Ÿæˆçš„æ•°æ®
- âœ… ç®¡ç†ç”¨æˆ·è´¦æˆ·ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- âœ… æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡å’Œç»Ÿè®¡ä¿¡æ¯

**é€‚ç”¨åœºæ™¯**ï¼š
- é¡¹ç›®è´Ÿè´£äºº
- ç³»ç»Ÿç®¡ç†å‘˜
- æ•°æ®å·¥ç¨‹å¸ˆ

### 2. å®¡æ ¸å‘˜ï¼ˆReviewerï¼‰

**æƒé™**ï¼š
- âœ… æŸ¥çœ‹å·²å®Œæˆçš„ä»»åŠ¡
- âœ… å®¡æ ¸ç”Ÿæˆçš„æ•°æ®ï¼ˆäººå·¥å®¡æ ¸ + è‡ªåŠ¨å®¡æ ¸ï¼‰
- âœ… å¯¼å‡ºå®¡æ ¸åçš„æ•°æ®
- âŒ åˆ›å»ºæ–°ä»»åŠ¡
- âŒ ä¿®æ”¹ç³»ç»Ÿé…ç½®
- âŒ ç®¡ç†ç”¨æˆ·

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®æ ‡æ³¨å‘˜
- è´¨é‡å®¡æ ¸äººå‘˜
- å†…å®¹å®¡æŸ¥å‘˜

---

## é»˜è®¤è´¦æˆ·

ç³»ç»Ÿé¦–æ¬¡å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªé»˜è®¤è´¦æˆ·ï¼š

### ç®¡ç†å‘˜è´¦æˆ·
```
ç”¨æˆ·å: admin
å¯†ç : admin123
è§’è‰²: ç®¡ç†å‘˜
```

### å®¡æ ¸å‘˜è´¦æˆ·
```
ç”¨æˆ·å: reviewer
å¯†ç : reviewer123
è§’è‰²: å®¡æ ¸å‘˜
```

âš ï¸ **å®‰å…¨æç¤º**ï¼šé¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç ï¼

---

## åŠŸèƒ½æƒé™

| åŠŸèƒ½ | ç®¡ç†å‘˜ | å®¡æ ¸å‘˜ |
|------|--------|--------|
| ç™»å½•ç³»ç»Ÿ | âœ… | âœ… |
| æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ | âœ… | âœ… |
| æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ… | âœ… | âœ… |
| åˆ›å»ºæ–°ä»»åŠ¡ | âœ… | âŒ |
| å¯åŠ¨/åœæ­¢ä»»åŠ¡ | âœ… | âŒ |
| åˆ é™¤ä»»åŠ¡ | âœ… | âŒ |
| ä¸Šä¼ æ–‡ä»¶ | âœ… | âŒ |
| é…ç½®ç³»ç»Ÿ | âœ… | âŒ |
| æ•°æ®å®¡æ ¸ | âœ… | âœ… |
| æ‰¹é‡å®¡æ ¸ | âœ… | âœ… |
| è‡ªåŠ¨å®¡æ ¸ | âœ… | âœ… |
| å¯¼å‡ºæ•°æ® | âœ… | âœ… |
| ç”¨æˆ·ç®¡ç† | âœ… | âŒ |
| ä¿®æ”¹å¯†ç  | âœ… | âœ… |

---

## ä½¿ç”¨æŒ‡å—

### 1. ç™»å½•ç³»ç»Ÿ

#### æ–¹å¼ä¸€ï¼šWeb ç•Œé¢ç™»å½•

1. è®¿é—® http://localhost:3003
2. ç³»ç»Ÿè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢
3. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
4. ç‚¹å‡»"ç™»å½•"æŒ‰é’®

![ç™»å½•é¡µé¢](./resources/images/login.png)

#### æ–¹å¼äºŒï¼šAPI ç™»å½•

```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer",
    "user": {
      "user_id": "xxx",
      "username": "admin",
      "email": "admin@graphgen.com",
      "role": "admin",
      "is_active": true
    }
  }
}
```

### 2. ä¿®æ”¹å¯†ç 

#### åœ¨ Web ç•Œé¢ä¿®æ”¹

1. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
2. é€‰æ‹©"ä¿®æ”¹å¯†ç "
3. è¾“å…¥æ—§å¯†ç å’Œæ–°å¯†ç 
4. ç‚¹å‡»"ç¡®å®š"

#### é€šè¿‡ API ä¿®æ”¹

```bash
curl -X POST http://localhost:8000/api/auth/change-password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "old_password": "admin123",
    "new_password": "new_password"
  }'
```

### 3. ç®¡ç†ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

#### æ·»åŠ æ–°ç”¨æˆ·

1. ç‚¹å‡»å¯¼èˆªæ çš„"ç”¨æˆ·ç®¡ç†"
2. ç‚¹å‡»"æ·»åŠ ç”¨æˆ·"æŒ‰é’®
3. å¡«å†™ç”¨æˆ·ä¿¡æ¯ï¼š
   - ç”¨æˆ·å
   - é‚®ç®±
   - å¯†ç 
   - è§’è‰²ï¼ˆç®¡ç†å‘˜/å®¡æ ¸å‘˜ï¼‰
4. ç‚¹å‡»"ç¡®å®š"

#### ç¼–è¾‘ç”¨æˆ·

1. åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·
2. ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®
3. ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
4. ç‚¹å‡»"ç¡®å®š"

#### åˆ é™¤ç”¨æˆ·

1. åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·
2. ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
3. ç¡®è®¤åˆ é™¤æ“ä½œ

âš ï¸ **æ³¨æ„**ï¼š
- ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç®¡ç†å‘˜è´¦æˆ·
- ä¸èƒ½åˆ é™¤è‡ªå·±çš„è´¦æˆ·

### 4. é€€å‡ºç™»å½•

1. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
2. é€‰æ‹©"é€€å‡ºç™»å½•"
3. ç³»ç»Ÿè‡ªåŠ¨æ¸…é™¤ç™»å½•çŠ¶æ€å¹¶è·³è½¬åˆ°ç™»å½•é¡µ

---

## API æ¥å£

### è®¤è¯ç›¸å…³

#### 1. ç”¨æˆ·ç™»å½•
```
POST /api/auth/login
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "admin",
  "password": "admin123"
}
```

#### 2. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```
GET /api/auth/me
Authorization: Bearer {token}
```

#### 3. ä¿®æ”¹å¯†ç 
```
POST /api/auth/change-password
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "old_password": "old_password",
  "new_password": "new_password"
}
```

### ç”¨æˆ·ç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ï¼‰

#### 4. è·å–æ‰€æœ‰ç”¨æˆ·
```
GET /api/auth/users
Authorization: Bearer {token}
```

#### 5. åˆ›å»ºç”¨æˆ·
```
POST /api/auth/register
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "newuser",
  "password": "password",
  "email": "user@example.com",
  "role": "reviewer"
}
```

#### 6. æ›´æ–°ç”¨æˆ·
```
PUT /api/auth/users/{username}
Authorization: Bearer {token}
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "email": "newemail@example.com",
  "role": "admin",
  "is_active": true
}
```

#### 7. åˆ é™¤ç”¨æˆ·
```
DELETE /api/auth/users/{username}
Authorization: Bearer {token}
```

### æƒé™ä¿æŠ¤çš„ç«¯ç‚¹

ä»¥ä¸‹ç«¯ç‚¹éœ€è¦ç‰¹å®šæƒé™ï¼š

**ä»…ç®¡ç†å‘˜**ï¼š
- `POST /api/upload` - ä¸Šä¼ æ–‡ä»¶
- `POST /api/tasks` - åˆ›å»ºä»»åŠ¡
- `POST /api/tasks/{task_id}/start` - å¯åŠ¨ä»»åŠ¡
- `DELETE /api/tasks/{task_id}` - åˆ é™¤ä»»åŠ¡
- `POST /api/config/save` - ä¿å­˜é…ç½®
- `GET /api/auth/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/auth/register` - æ³¨å†Œç”¨æˆ·
- `PUT /api/auth/users/{username}` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/auth/users/{username}` - åˆ é™¤ç”¨æˆ·

**ç®¡ç†å‘˜å’Œå®¡æ ¸å‘˜**ï¼š
- `GET /api/reviews/{task_id}/data` - è·å–å®¡æ ¸æ•°æ®
- `POST /api/reviews/review` - å®¡æ ¸æ•°æ®é¡¹
- `POST /api/reviews/batch-review` - æ‰¹é‡å®¡æ ¸
- `POST /api/reviews/auto-review` - è‡ªåŠ¨å®¡æ ¸

---

## å®‰å…¨è¯´æ˜

### å¯†ç å®‰å…¨

1. **å¯†ç å“ˆå¸Œ**ï¼šä½¿ç”¨ SHA256 + Salt è¿›è¡Œå¯†ç å“ˆå¸Œ
2. **å¯†ç é•¿åº¦**ï¼šå»ºè®®ä½¿ç”¨ 8 ä½ä»¥ä¸Šçš„å¼ºå¯†ç 
3. **å®šæœŸæ›´æ¢**ï¼šå»ºè®®å®šæœŸæ›´æ¢å¯†ç 

### Token å®‰å…¨

1. **æœ‰æ•ˆæœŸ**ï¼šToken é»˜è®¤æœ‰æ•ˆæœŸä¸º 7 å¤©
2. **å­˜å‚¨ä½ç½®**ï¼šToken å­˜å‚¨åœ¨æµè§ˆå™¨ LocalStorage
3. **è‡ªåŠ¨è¿‡æœŸ**ï¼šToken è¿‡æœŸåè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

### ä¼šè¯ç®¡ç†

1. **å•ç‚¹ç™»å½•**ï¼šåŒä¸€è´¦æˆ·å¯åœ¨å¤šä¸ªè®¾å¤‡ç™»å½•
2. **è‡ªåŠ¨ç™»å‡º**ï¼šToken è¿‡æœŸæˆ–æ— æ•ˆæ—¶è‡ªåŠ¨ç™»å‡º
3. **å®‰å…¨é€€å‡º**ï¼šé€€å‡ºç™»å½•æ—¶æ¸…é™¤æ‰€æœ‰æœ¬åœ°å‡­è¯

### æœ€ä½³å®è·µ

1. âœ… é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç 
2. âœ… ä½¿ç”¨å¼ºå¯†ç ï¼ˆåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
3. âœ… ä¸è¦åœ¨å…¬å…±åœºæ‰€ä¿æŒç™»å½•çŠ¶æ€
4. âœ… å®šæœŸå®¡æŸ¥ç”¨æˆ·è´¦æˆ·å’Œæƒé™
5. âœ… åŠæ—¶ç¦ç”¨ç¦»èŒäººå‘˜çš„è´¦æˆ·
6. âœ… ä½¿ç”¨ HTTPS éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
7. âŒ ä¸è¦å…±äº«è´¦æˆ·
8. âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ— æ³•ç™»å½•

**ç—‡çŠ¶**ï¼šè¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç åä»ç„¶æ— æ³•ç™»å½•

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š`lsof -i :8000`
2. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`tail -f /tmp/backend.log`
3. ç¡®è®¤ç”¨æˆ·è´¦æˆ·æ˜¯å¦è¢«ç¦ç”¨
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ LocalStorage

### é—®é¢˜ 2ï¼šToken è¿‡æœŸ

**ç—‡çŠ¶**ï¼šé¡µé¢æç¤º"ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. é‡æ–°ç™»å½•è·å–æ–°çš„ Token
2. å¦‚æœé¢‘ç¹è¿‡æœŸï¼Œæ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 3ï¼šæƒé™ä¸è¶³

**ç—‡çŠ¶**ï¼šè®¿é—®æŸäº›åŠŸèƒ½æ—¶æç¤º"æƒé™ä¸è¶³"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤å½“å‰ç”¨æˆ·çš„è§’è‰²
2. è”ç³»ç®¡ç†å‘˜æå‡æƒé™æˆ–ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·

### é—®é¢˜ 4ï¼šç”¨æˆ·æ•°æ®ä¸¢å¤±

**ç—‡çŠ¶**ï¼šé‡å¯æœåŠ¡åç”¨æˆ·æ•°æ®ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `cache/users.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. å¦‚æœæ–‡ä»¶ä¸¢å¤±ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡å»ºé»˜è®¤è´¦æˆ·
3. å»ºè®®å®šæœŸå¤‡ä»½ `cache/users.json` æ–‡ä»¶

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ï¼š

```bash
# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä¿®æ”¹ï¼‰
SECRET_KEY=your-secret-key-change-this-in-production

# Token è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
ACCESS_TOKEN_EXPIRE_MINUTES=10080  # 7å¤©
```

### ç”¨æˆ·æ•°æ®å­˜å‚¨

ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ï¼š`cache/users.json`

**æ•°æ®ç»“æ„**ï¼š
```json
{
  "admin": {
    "user_id": "uuid",
    "username": "admin",
    "password_hash": "hashed_password",
    "email": "admin@graphgen.com",
    "role": "admin",
    "is_active": true,
    "created_at": "2025-10-26T...",
    "last_login": "2025-10-26T..."
  }
}
```

---

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æƒé™æ£€æŸ¥

åœ¨ API ç«¯ç‚¹ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼š

```python
from backend.dependencies import require_admin, require_admin_or_reviewer

@router.post("/my-endpoint")
async def my_endpoint(current_user: User = Depends(require_admin)):
    # ä»…ç®¡ç†å‘˜å¯è®¿é—®
    pass
```

### å‰ç«¯æƒé™æ§åˆ¶

åœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

```vue
<template>
  <el-button v-if="authStore.isAdmin" @click="handleAction">
    ç®¡ç†å‘˜åŠŸèƒ½
  </el-button>
</template>

<script setup>
import { useAuthStore } from '@/stores/auth'
const authStore = useAuthStore()
</script>
```

### è·¯ç”±æƒé™æ§åˆ¶

åœ¨è·¯ç”±é…ç½®ä¸­æ·»åŠ  metaï¼š

```typescript
{
  path: '/admin',
  component: AdminView,
  meta: {
    requiresAuth: true,
    requiresAdmin: true
  }
}
```

---

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2025-10-26)

- âœ¨ æ–°å¢ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ¨ æ–°å¢åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- âœ¨ æ–°å¢ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ¨ æ–°å¢ç™»å½•/ç™»å‡ºåŠŸèƒ½
- âœ¨ æ–°å¢å¯†ç ä¿®æ”¹åŠŸèƒ½
- ğŸ”’ å¢å¼ºç³»ç»Ÿå®‰å…¨æ€§

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
2. æŸ¥çœ‹ `SYSTEM_STATUS.md` äº†è§£ç³»ç»ŸçŠ¶æ€
3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`tail -f /tmp/backend.log`
4. è®¿é—® API æ–‡æ¡£ï¼šhttp://localhost:8000/docs

---

**GraphGen v2.0.0** - æ•°æ®ç”Ÿæˆä¸ç®¡ç†å¹³å°  
Â© 2025 GraphGen Team

