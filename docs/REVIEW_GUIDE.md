# GraphGen 数据审核功能使用指南

## 📋 功能概述

GraphGen 数据审核功能提供了完整的数据质量审核流程，包括：

- **人工审核** - 标注员可以逐条审核、修改数据
- **自动审核** - 使用大模型自动评估数据质量
- **批量操作** - 支持批量通过、拒绝数据
- **数据导出** - 导出审核通过的高质量数据

## 🚀 快速开始

### 1. 访问审核页面

在任务列表中，找到已完成的任务，点击"审核"按钮进入审核页面。

### 2. 审核统计

页面顶部显示审核统计信息：
- **总数** - 数据总条数
- **待审核** - 未审核的数据
- **已通过** - 人工审核通过
- **已拒绝** - 人工审核拒绝
- **已修改** - 修改后通过
- **自动通过** - 自动审核通过
- **自动拒绝** - 自动审核拒绝

## 🔧 功能详解

### 人工审核

#### 单条审核

1. **查看详情** - 点击"查看"按钮，查看数据的完整内容
2. **通过** - 点击"通过"按钮，标记数据为已通过
3. **拒绝** - 点击"拒绝"按钮，标记数据为已拒绝
4. **修改** - 点击"修改"按钮，编辑数据内容

#### 修改数据

在编辑对话框中，您可以：
- 修改问题/指令
- 修改输入内容
- 修改输出/答案
- 添加审核备注
- 填写审核人姓名

修改后的数据会自动标记为"已修改"状态。

#### 批量操作

1. 勾选需要批量操作的数据
2. 点击"批量通过"或"批量拒绝"按钮
3. 系统会自动处理所有选中的数据

### 自动审核（AI 辅助）

#### 工作原理

自动审核使用大语言模型对数据进行多维度评估：

1. **相关性** (Relevance) - 问题和答案是否相关
2. **准确性** (Accuracy) - 答案内容是否准确
3. **完整性** (Completeness) - 答案是否完整
4. **清晰度** (Clarity) - 表达是否清晰
5. **有用性** (Usefulness) - 对模型训练是否有价值

每个维度评分 0-1 分，综合评分作为数据质量的依据。

#### 使用步骤

1. 点击"自动审核"按钮
2. 选择审核范围：
   - **已选中的数据** - 仅审核勾选的数据
   - **所有待审核数据** - 审核所有未审核的数据
   - **全部数据** - 审核所有数据（包括已审核的）
3. 设置通过阈值（默认 70%）
4. 选择是否自动通过/拒绝：
   - **自动通过** - 高于阈值自动标记为通过
   - **自动拒绝** - 低于阈值 20% 自动标记为拒绝
5. 点击"开始自动审核"

#### 审核结果

自动审核完成后，每条数据会显示：
- **自动评分** - 综合质量评分（0-100%）
- **审核原因** - 简短的评估理由
- **审核状态** - 根据设置自动标记状态

您可以查看详情了解完整的评估结果，并根据需要手动调整。

### 数据筛选

使用状态筛选器可以快速查看特定状态的数据：
- 待审核
- 已通过
- 已拒绝
- 已修改
- 自动通过
- 自动拒绝

### 数据导出

点击"导出数据"按钮，系统会：
1. 导出所有通过审核的数据（已通过、已修改、自动通过）
2. 优先使用修改后的内容
3. 生成 JSON 文件供下载

导出的数据可以直接用于模型训练。

## 📊 审核流程建议

### 推荐流程

1. **自动审核** - 先使用自动审核快速筛选数据
   - 设置合适的阈值（建议 70-80%）
   - 开启自动通过，关闭自动拒绝
   - 让高质量数据自动通过

2. **人工复审** - 重点审核以下数据
   - 自动评分在阈值附近的数据（60-80%）
   - 自动拒绝的数据（确认是否真的有问题）
   - 随机抽查自动通过的数据

3. **批量处理** - 对明显的数据进行批量操作
   - 批量通过高质量数据
   - 批量拒绝低质量数据

4. **修改完善** - 对有潜力的数据进行修改
   - 修正错误的答案
   - 补充不完整的内容
   - 优化表达方式

5. **导出使用** - 导出审核通过的数据用于训练

### 质量标准

建议的数据质量标准：

**通过标准**
- 问题和答案高度相关
- 答案准确无误
- 内容完整充分
- 表达清晰流畅
- 对训练有价值

**拒绝标准**
- 答非所问
- 内容明显错误
- 信息严重不足
- 表达混乱难懂
- 无实际价值

**修改标准**
- 整体质量尚可
- 存在小问题可修正
- 修改后可达到通过标准

## 🎯 最佳实践

### 1. 合理设置阈值

- **高标准项目**（如专业领域）- 阈值 80-90%
- **一般项目** - 阈值 70-80%
- **宽松标准**（如创意类）- 阈值 60-70%

### 2. 分批审核

- 不要一次性审核所有数据
- 每批 50-100 条，保持注意力集中
- 定期休息，避免审核疲劳

### 3. 双重审核

- 重要项目建议双人审核
- 一人初审，一人复审
- 提高审核质量和一致性

### 4. 记录标准

- 在审核备注中记录拒绝/修改原因
- 便于后续分析和改进
- 帮助团队统一标准

### 5. 定期抽查

- 定期抽查自动通过的数据
- 验证自动审核的准确性
- 调整阈值和策略

## 🔍 故障排除

### 自动审核失败

**可能原因**
- LLM API 配置错误
- API 额度不足
- 网络连接问题

**解决方法**
1. 检查 `.env` 文件中的 API 配置
2. 确认 API Key 有效且有足够额度
3. 检查网络连接
4. 查看后端日志了解详细错误

### 数据加载失败

**可能原因**
- 任务输出文件不存在
- 文件格式错误

**解决方法**
1. 确认任务已完成
2. 检查任务输出目录
3. 确认输出文件格式正确

### 导出失败

**可能原因**
- 没有审核通过的数据
- 文件权限问题

**解决方法**
1. 确保至少有一条通过审核的数据
2. 检查文件系统权限
3. 查看后端日志

## 📝 API 接口

如果需要通过 API 进行审核，可以使用以下接口：

### 获取审核数据
```
GET /api/reviews/{task_id}/data
```

### 审核单个数据
```
POST /api/reviews/review
{
  "item_id": "task_id_0",
  "review_status": "approved",
  "review_comment": "数据质量良好",
  "reviewer": "张三"
}
```

### 批量审核
```
POST /api/reviews/batch-review
{
  "item_ids": ["task_id_0", "task_id_1"],
  "review_status": "approved",
  "reviewer": "张三"
}
```

### 自动审核
```
POST /api/reviews/auto-review
{
  "item_ids": ["task_id_0", "task_id_1"],
  "threshold": 0.7,
  "auto_approve": true,
  "auto_reject": false
}
```

### 导出数据
```
GET /api/reviews/{task_id}/export?status_filter=approved,modified
```

详细的 API 文档请访问：http://localhost:8000/docs

## 🎉 总结

GraphGen 的数据审核功能提供了：

- ✅ **高效的人工审核** - 直观的界面，快速的操作
- ✅ **智能的自动审核** - AI 辅助，提高效率
- ✅ **灵活的批量操作** - 批量处理，节省时间
- ✅ **完整的审核流程** - 从审核到导出一站式完成

通过合理使用这些功能，您可以高效地筛选出高质量的训练数据，提升模型训练效果！

---

**祝您审核愉快！** 🚀
