# KGE-Gen ä»£ç æ¶æ„ä¸æ ¸å¿ƒé€»è¾‘è¯´æ˜

> æœ¬æ–‡æ¡£é¢å‘æ–°æ‰‹å¼€å‘è€…ï¼Œè¯¦ç»†è¯´æ˜ KGE-Gen é¡¹ç›®çš„ä¸»è¦æ¡†æ¶ã€é€»è¾‘å’Œæ ¸å¿ƒæ¨¡å—ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
- [æ ¸å¿ƒå·¥ä½œæµç¨‹](#æ ¸å¿ƒå·¥ä½œæµç¨‹)
- [ä¸»è¦æ¨¡å—è¯´æ˜](#ä¸»è¦æ¨¡å—è¯´æ˜)
- [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
- [å…³é”®æ¦‚å¿µ](#å…³é”®æ¦‚å¿µ)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [å¿«é€Ÿä¸Šæ‰‹](#å¿«é€Ÿä¸Šæ‰‹)

---

## é¡¹ç›®æ¦‚è¿°

KGE-Gen æ˜¯ä¸€ä¸ª**çŸ¥è¯†å›¾è°±å¼•å¯¼çš„åˆæˆæ•°æ®ç”Ÿæˆå¹³å°**ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ï¼š

1. **ä»æ–‡æ¡£æ„å»ºçŸ¥è¯†å›¾è°±**ï¼šä»åŸå§‹æ–‡æ¡£ï¼ˆæ–‡æœ¬ã€PDFã€CSVç­‰ï¼‰ä¸­æå–å®ä½“å’Œå…³ç³»ï¼Œæ„å»ºç»“æ„åŒ–çŸ¥è¯†å›¾è°±
2. **ç”Ÿæˆè®­ç»ƒæ•°æ®**ï¼šåŸºäºçŸ¥è¯†å›¾è°±ç”Ÿæˆé«˜è´¨é‡çš„é—®ç­”å¯¹ï¼ˆQA pairsï¼‰ï¼Œç”¨äºè®­ç»ƒå¤§è¯­è¨€æ¨¡å‹
3. **æä¾› Web ç•Œé¢**ï¼šé€šè¿‡ Web UI å’Œ API æ¥å£ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£ã€ç®¡ç†ä»»åŠ¡ã€å®¡æ ¸æ•°æ®

### æ ¸å¿ƒä»·å€¼

- **è§£å†³æ•°æ®ç¨€ç¼ºé—®é¢˜**ï¼šè‡ªåŠ¨ç”Ÿæˆå¤§é‡é«˜è´¨é‡è®­ç»ƒæ•°æ®
- **çŸ¥è¯†å›¾è°±å¼•å¯¼**ï¼šé€šè¿‡ç»“æ„åŒ–çŸ¥è¯†ç¡®ä¿ç”Ÿæˆæ•°æ®çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§
- **å¤šç§ç”Ÿæˆæ¨¡å¼**ï¼šæ”¯æŒåŸå­é—®ç­”ã€èšåˆé—®ç­”ã€å¤šè·³é—®ç­”ã€é“¾å¼æ€è€ƒç­‰å¤šç§æ¨¡å¼

---

## æ•´ä½“æ¶æ„

KGE-Gen é‡‡ç”¨**å‰åç«¯åˆ†ç¦»**çš„æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚ (Frontend)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Vue 3 å‰ç«¯  â”‚  â”‚  Gradio WebUIâ”‚  â”‚   CLI å·¥å…·   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      FastAPI åç«¯æœåŠ¡ (Backend)     â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚  â”‚   API è·¯ç”± / ä»»åŠ¡ç®¡ç†        â”‚  â”‚
          â”‚  â”‚   ç”¨æˆ·è®¤è¯ / æ•°æ®å®¡æ ¸        â”‚  â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    KGE-Gen æ ¸å¿ƒåº“ (Core Library)  â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚  â”‚  çŸ¥è¯†æ„å»º / å›¾ç»„ç»‡ / QAç”Ÿæˆ   â”‚  â”‚
          â”‚  â”‚  LLM è°ƒç”¨ / å­˜å‚¨ç®¡ç†          â”‚  â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚æ¶æ„è¯´æ˜

#### 1. **å‰ç«¯å±‚** (`frontend/`, `webui/`)
- **Vue 3 å‰ç«¯**ï¼šæä¾›ç°ä»£åŒ–çš„ Web ç•Œé¢ï¼Œç”¨äºä»»åŠ¡ç®¡ç†ã€æ•°æ®å®¡æ ¸
- **Gradio WebUI**ï¼šæä¾›ç®€å•çš„äº¤äº’ç•Œé¢
- **CLI å·¥å…·**ï¼šå‘½ä»¤è¡Œæ¥å£ï¼Œé€‚åˆæ‰¹é‡å¤„ç†

#### 2. **åç«¯æœåŠ¡å±‚** (`backend/`)
- **FastAPI åº”ç”¨**ï¼šæä¾› RESTful API æ¥å£
- **ä»»åŠ¡ç®¡ç†**ï¼šå¤„ç†ä»»åŠ¡åˆ›å»ºã€æ‰§è¡Œã€çŠ¶æ€è¿½è¸ª
- **ç”¨æˆ·è®¤è¯**ï¼šJWT Token è®¤è¯ï¼Œæ”¯æŒç®¡ç†å‘˜å’Œå®¡æ ¸å‘˜è§’è‰²
- **æ•°æ®å®¡æ ¸**ï¼šæ”¯æŒäººå·¥å®¡æ ¸å’Œè‡ªåŠ¨å®¡æ ¸

#### 3. **æ ¸å¿ƒåº“å±‚** (`graphgen/`)
- **KGE-Gen æ ¸å¿ƒé€»è¾‘**ï¼šçŸ¥è¯†å›¾è°±æ„å»ºå’Œ QA ç”Ÿæˆçš„æ ¸å¿ƒç®—æ³•
- **å­˜å‚¨ç³»ç»Ÿ**ï¼šæ–‡æ¡£å­˜å‚¨ã€çŸ¥è¯†å›¾è°±å­˜å‚¨ã€QA å­˜å‚¨
- **LLM å®¢æˆ·ç«¯**ï¼šå°è£… OpenAIã€Ollama ç­‰ LLM æ¥å£

---

## æ ¸å¿ƒå·¥ä½œæµç¨‹

KGE-Gen çš„æ ¸å¿ƒå·¥ä½œæµç¨‹åˆ†ä¸º**å››ä¸ªä¸»è¦æ­¥éª¤**ï¼š

```
åŸå§‹æ–‡æ¡£
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: çŸ¥è¯†æ„å»º (Knowledge Construction)â”‚
â”‚  - æ–‡æ¡£è¯»å–å’Œåˆ†å‰²                        â”‚
â”‚  - å®ä½“å’Œå…³ç³»æå–                        â”‚
â”‚  - çŸ¥è¯†å›¾è°±æ„å»º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: ç†è§£è¯„ä¼° (Comprehension Assess) â”‚
â”‚  - è¯­ä¹‰å˜ä½“ç”Ÿæˆ (å¯é€‰)                   â”‚
â”‚  - ç½®ä¿¡åº¦è¯„ä¼° (å¯é€‰)                     â”‚
â”‚  - çŸ¥è¯†ç›²ç‚¹è¯†åˆ«                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: å›¾ç»„ç»‡ (Graph Organization)      â”‚
â”‚  - çŸ¥è¯†å›¾è°±åˆ†åŒº                          â”‚
â”‚  - å­å›¾æå– (k-hop)                      â”‚
â”‚  - æ‰¹æ¬¡å‡†å¤‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤4: QA ç”Ÿæˆ (QA Generation)          â”‚
â”‚  - é—®é¢˜ç”Ÿæˆ                              â”‚
â”‚  - ç­”æ¡ˆç”Ÿæˆ                              â”‚
â”‚  - æ ¼å¼åŒ–è¾“å‡º                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
          é—®ç­”å¯¹æ•°æ®
```

### è¯¦ç»†æµç¨‹è¯´æ˜

#### æ­¥éª¤1: çŸ¥è¯†æ„å»º (`insert()`)

**ä»£ç ä½ç½®**ï¼š`graphgen/graphgen.py::GraphGen.insert()`

**ä¸»è¦æµç¨‹**ï¼š

1. **æ–‡æ¡£è¯»å–** (`graphgen/operators/read/read_files.py`)
   - æ”¯æŒå¤šç§æ ¼å¼ï¼šæ–‡æœ¬ã€PDFã€CSVã€JSONã€JSONL
   - ä½¿ç”¨ä¸åŒçš„ Reader ç±»å¤„ç†ä¸åŒæ ¼å¼

2. **æ–‡æ¡£åˆ†å‰²** (`graphgen/operators/split/split_chunks.py`)
   - å°†é•¿æ–‡æ¡£åˆ†å‰²æˆè¾ƒå°çš„ chunkï¼ˆç‰‡æ®µï¼‰
   - æ”¯æŒå¤šç§åˆ†å‰²ç­–ç•¥ï¼šé€’å½’å­—ç¬¦åˆ†å‰²ã€Markdown åˆ†å‰²ç­‰
   - é…ç½®å‚æ•°ï¼š`chunk_size`ï¼ˆåˆ†å—å¤§å°ï¼‰ã€`chunk_overlap`ï¼ˆé‡å å¤§å°ï¼‰

3. **å®ä½“å’Œå…³ç³»æå–** (`graphgen/operators/build_kg/build_text_kg.py`)
   - ä½¿ç”¨ LLMï¼ˆåˆæˆå™¨æ¨¡å‹ï¼‰ä»æ¯ä¸ª chunk ä¸­æå–å®ä½“å’Œå…³ç³»
   - æå–å™¨ï¼š`graphgen/models/kg_builder/light_rag_kg_builder.py`
   - æç¤ºæ¨¡æ¿ï¼š`graphgen/templates/kg/kg_extraction.py`

4. **çŸ¥è¯†èšåˆ**
   - å°†å¤šä¸ª chunk ä¸­æå–çš„å®ä½“å’Œå…³ç³»åˆå¹¶
   - ç›¸åŒå®ä½“/å…³ç³»ä¼šè¢«åˆå¹¶ï¼Œæè¿°ä¼šè¢«èšåˆ
   - å­˜å‚¨åˆ° `NetworkXStorage`ï¼ˆåŸºäº NetworkX çš„å›¾å­˜å‚¨ï¼‰

**å…³é”®ä»£ç **ï¼š

```python
# graphgen/graphgen.py:92-163
async def insert(self, read_config: Dict, split_config: Dict):
    # 1. è¯»å–æ–‡ä»¶
    data = read_files(read_config["input_file"], self.working_dir)
    
    # 2. åˆ†å‰²æ–‡æ¡£
    inserting_chunks = await chunk_documents(
        text_docs,
        split_config["chunk_size"],
        split_config["chunk_overlap"],
        self.tokenizer_instance,
    )
    
    # 3. æå–å®ä½“å’Œå…³ç³»
    _add_entities_and_relations = await build_text_kg(
        llm_client=self.synthesizer_llm_client,
        kg_instance=self.graph_storage,
        chunks=inserting_chunks,
    )
```

#### æ­¥éª¤2: ç†è§£è¯„ä¼° (`quiz_and_judge()`)

**ä»£ç ä½ç½®**ï¼š`graphgen/graphgen.py::KGE-Gen.quiz_and_judge()`

**ä¸»è¦æµç¨‹**ï¼š

1. **è¯­ä¹‰å˜ä½“ç”Ÿæˆ** (`graphgen/operators/quiz.py`)
   - å¯¹çŸ¥è¯†å›¾è°±ä¸­çš„æ¯æ¡è¾¹ï¼ˆå…³ç³»ï¼‰ç”Ÿæˆå¤šä¸ªè¯­ä¹‰å˜ä½“
   - ç”Ÿæˆè‚¯å®šå½¢å¼å’Œå¦å®šå½¢å¼
   - ç”¨äºåç»­çš„ç½®ä¿¡åº¦è¯„ä¼°

2. **ç½®ä¿¡åº¦è¯„ä¼°** (`graphgen/operators/judge.py`)
   - ä½¿ç”¨è®­ç»ƒæ¨¡å‹ï¼ˆTrainee Modelï¼‰å¯¹è¯­ä¹‰å˜ä½“è¿›è¡Œåˆ¤æ–­
   - è®¡ç®—æ¨¡å‹å¯¹æ¯ä¸ªçŸ¥è¯†ç‚¹çš„ç½®ä¿¡åº¦
   - è¯†åˆ«çŸ¥è¯†ç›²ç‚¹ï¼ˆç½®ä¿¡åº¦ä½çš„çŸ¥è¯†ç‚¹ï¼‰

3. **ç†è§£æŸå¤±è®¡ç®—** (`graphgen/utils/calculate_confidence.py`)
   - åŸºäºç½®ä¿¡åº¦è®¡ç®—ç†è§£æŸå¤±ï¼ˆComprehension Lossï¼‰
   - ç”¨äºåç»­çš„å›¾åˆ†åŒºç­–ç•¥ï¼ˆECE æ–¹æ³•ï¼‰

**æ³¨æ„**ï¼šæ­¤æ­¥éª¤æ˜¯å¯é€‰çš„ï¼Œåªæœ‰åœ¨é…ç½®äº† `if_trainee_model=True` æ—¶æ‰ä¼šæ‰§è¡Œã€‚

#### æ­¥éª¤3: å›¾ç»„ç»‡ (`generate()` ä¸­çš„åˆ†åŒº)

**ä»£ç ä½ç½®**ï¼š`graphgen/operators/partition/partition_kg.py`

**ä¸»è¦æµç¨‹**ï¼š

1. **çŸ¥è¯†å›¾è°±åˆ†åŒº**
   - å°†æ•´ä¸ªçŸ¥è¯†å›¾è°±åˆ†å‰²æˆå¤šä¸ªå­å›¾ï¼ˆç¤¾åŒº/æ‰¹æ¬¡ï¼‰
   - æ”¯æŒå¤šç§åˆ†åŒºæ–¹æ³•ï¼š
     - **BFS**ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢åˆ†åŒº
     - **DFS**ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢åˆ†åŒº
     - **ECE**ï¼šåŸºäºé¢„æœŸæ ¡å‡†è¯¯å·®çš„åˆ†åŒºï¼ˆä¼˜å…ˆé€‰æ‹©çŸ¥è¯†ç›²ç‚¹ï¼‰
     - **Leiden**ï¼šåŸºäºç¤¾åŒºæ£€æµ‹çš„åˆ†åŒº
     - **Anchor BFS**ï¼šåŸºäºé”šç‚¹çš„ BFS åˆ†åŒº

2. **å­å›¾æå–**
   - å¯¹æ¯ä¸ªç¤¾åŒºæå– k-hop å­å›¾ï¼ˆk è·³é‚»åŸŸï¼‰
   - åŒ…å«èŠ‚ç‚¹ã€è¾¹å’Œç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

3. **æ‰¹æ¬¡å‡†å¤‡**
   - å°†å­å›¾ç»„ç»‡æˆæ‰¹æ¬¡ï¼ˆbatchï¼‰
   - æ¯ä¸ªæ‰¹æ¬¡åŒ…å«èŠ‚ç‚¹åˆ—è¡¨å’Œè¾¹åˆ—è¡¨

**å…³é”®ä»£ç **ï¼š

```python
# graphgen/graphgen.py:303-310
async def generate(self, partition_config: Dict, generate_config: Dict):
    # Step 1: å›¾åˆ†åŒº
    batches = await partition_kg(
        self.graph_storage,
        self.chunks_storage,
        self.tokenizer_instance,
        partition_config,
    )
```

#### æ­¥éª¤4: QA ç”Ÿæˆ (`generate()` ä¸­çš„ç”Ÿæˆ)

**ä»£ç ä½ç½®**ï¼š`graphgen/operators/generate/generate_qas.py`

**ä¸»è¦æµç¨‹**ï¼š

1. **é€‰æ‹©ç”Ÿæˆå™¨**
   - æ ¹æ®é…ç½®çš„ `mode` é€‰æ‹©å¯¹åº”çš„ç”Ÿæˆå™¨ï¼š
     - **atomic**ï¼šåŸå­é—®ç­”ç”Ÿæˆå™¨ (`AtomicGenerator`)
     - **aggregated**ï¼šèšåˆé—®ç­”ç”Ÿæˆå™¨ (`AggregatedGenerator`)
     - **multi_hop**ï¼šå¤šè·³é—®ç­”ç”Ÿæˆå™¨ (`MultiHopGenerator`)
     - **cot**ï¼šé“¾å¼æ€è€ƒç”Ÿæˆå™¨ (`CoTGenerator`)
     - **all**ï¼šç”Ÿæˆæ‰€æœ‰æ¨¡å¼

2. **é—®é¢˜ç”Ÿæˆ**
   - å¯¹æ¯ä¸ªæ‰¹æ¬¡ï¼ˆå­å›¾ï¼‰ï¼Œä½¿ç”¨ LLM ç”Ÿæˆé—®é¢˜
   - ä¸åŒæ¨¡å¼ä½¿ç”¨ä¸åŒçš„æç¤ºæ¨¡æ¿
   - æ¨¡æ¿ä½ç½®ï¼š`graphgen/templates/generation/`

3. **ç­”æ¡ˆç”Ÿæˆ**
   - å¯¹äº atomic æ¨¡å¼ï¼Œå¯èƒ½é‡‡ç”¨ä¸¤é˜¶æ®µç”Ÿæˆï¼š
     - å…ˆç”Ÿæˆé—®é¢˜ï¼Œå†å»é‡
     - å†ä¸ºæ¯ä¸ªé—®é¢˜ç”Ÿæˆç­”æ¡ˆ
   - å…¶ä»–æ¨¡å¼é€šå¸¸ä¸€æ¬¡æ€§ç”Ÿæˆé—®ç­”å¯¹

4. **æ ¼å¼åŒ–è¾“å‡º**
   - å°†ç”Ÿæˆçš„é—®ç­”å¯¹æ ¼å¼åŒ–ä¸ºæŒ‡å®šæ ¼å¼ï¼š
     - **Alpaca**ï¼š`{"instruction": "...", "input": "...", "output": "..."}`
     - **ShareGPT**ï¼š`{"conversations": [...]}`
     - **ChatML**ï¼š`{"messages": [...]}`
   - æ·»åŠ å…ƒæ•°æ®ï¼šcontextã€graphã€source_chunks ç­‰

5. **å»é‡å’Œé™åˆ¶**
   - åŸºäºé—®é¢˜å†…å®¹çš„ hash è¿›è¡Œå»é‡
   - å¦‚æœé…ç½®äº† `target_qa_pairs`ï¼Œé™åˆ¶ç”Ÿæˆæ•°é‡
   - å¦‚æœé…ç½®äº† `mode_ratios`ï¼ŒæŒ‰æ¯”ä¾‹åˆ†é…å„æ¨¡å¼çš„æ•°é‡

**å…³é”®ä»£ç **ï¼š

```python
# graphgen/operators/generate/generate_qas.py:89-321
async def generate_qas(
    llm_client: BaseLLMClient,
    batches: list,
    generation_config: dict,
    ...
):
    mode = generation_config["mode"]
    
    # é€‰æ‹©ç”Ÿæˆå™¨
    if mode == "atomic":
        generator = AtomicGenerator(actual_llm_client, ...)
    elif mode == "aggregated":
        generator = AggregatedGenerator(actual_llm_client, ...)
    # ...
    
    # ç”Ÿæˆ QA å¯¹
    results = await run_concurrent(
        generate_with_storage,
        batches,
        desc="[4/4]Generating QAs",
    )
    
    # æ ¼å¼åŒ–è¾“å‡º
    formatted_results = generator.format_generation_results(
        results,
        output_data_format=data_format
    )
```

---

## ä¸»è¦æ¨¡å—è¯´æ˜

### 1. æ ¸å¿ƒç±»ï¼š`KGE-Gen`

**ä½ç½®**ï¼š`graphgen/graphgen.py`

**èŒè´£**ï¼šKGE-Gen çš„æ ¸å¿ƒç±»ï¼Œå°è£…äº†æ•´ä¸ªå·¥ä½œæµç¨‹ã€‚

**ä¸»è¦å±æ€§**ï¼š
- `synthesizer_llm_client`ï¼šåˆæˆå™¨ LLM å®¢æˆ·ç«¯ï¼ˆç”¨äºæå–å’Œç”Ÿæˆï¼‰
- `trainee_llm_client`ï¼šè®­ç»ƒæ¨¡å‹ LLM å®¢æˆ·ç«¯ï¼ˆç”¨äºè¯„ä¼°ï¼Œå¯é€‰ï¼‰
- `tokenizer_instance`ï¼šåˆ†è¯å™¨å®ä¾‹
- `graph_storage`ï¼šçŸ¥è¯†å›¾è°±å­˜å‚¨ï¼ˆNetworkXï¼‰
- `chunks_storage`ï¼šæ–‡æ¡£ç‰‡æ®µå­˜å‚¨ï¼ˆJSONï¼‰
- `qa_storage`ï¼šé—®ç­”å¯¹å­˜å‚¨ï¼ˆJSON Listï¼‰

**ä¸»è¦æ–¹æ³•**ï¼š
- `insert()`ï¼šçŸ¥è¯†æ„å»º
- `search()`ï¼šå¤–éƒ¨æœç´¢ï¼ˆå¯é€‰ï¼‰
- `quiz_and_judge()`ï¼šç†è§£è¯„ä¼°ï¼ˆå¯é€‰ï¼‰
- `generate()`ï¼šQA ç”Ÿæˆ
- `clear()`ï¼šæ¸…ç†æ‰€æœ‰å­˜å‚¨

### 2. å­˜å‚¨ç³»ç»Ÿ

#### `NetworkXStorage` (`graphgen/models/storage/networkx_storage.py`)
- **ç”¨é€”**ï¼šå­˜å‚¨çŸ¥è¯†å›¾è°±ï¼ˆèŠ‚ç‚¹å’Œè¾¹ï¼‰
- **åº•å±‚**ï¼šåŸºäº NetworkX å›¾åº“
- **æ–¹æ³•**ï¼š`add_node()`, `add_edge()`, `get_all_nodes()`, `get_all_edges()`

#### `JsonKVStorage` (`graphgen/models/storage/json_storage.py`)
- **ç”¨é€”**ï¼šé”®å€¼å¯¹å­˜å‚¨ï¼ˆæ–‡æ¡£ã€ç‰‡æ®µã€æœç´¢ç»“æœç­‰ï¼‰
- **æ ¼å¼**ï¼šJSON æ–‡ä»¶
- **æ–¹æ³•**ï¼š`upsert()`, `get_by_id()`, `filter_keys()`

#### `JsonListStorage` (`graphgen/models/storage/json_storage.py`)
- **ç”¨é€”**ï¼šåˆ—è¡¨å­˜å‚¨ï¼ˆé—®ç­”å¯¹ï¼‰
- **æ ¼å¼**ï¼šJSON æ•°ç»„æ–‡ä»¶
- **æ–¹æ³•**ï¼š`upsert()`, `all_items()`

### 3. LLM å®¢æˆ·ç«¯

#### `OpenAIClient` (`graphgen/models/llm/openai_client.py`)
- **ç”¨é€”**ï¼šå°è£… OpenAI å…¼å®¹çš„ API è°ƒç”¨
- **åŠŸèƒ½**ï¼š
  - å¼‚æ­¥è°ƒç”¨ LLM API
  - Token ä½¿ç”¨é‡ç»Ÿè®¡
  - è¯·æ±‚é™æµï¼ˆRPM/TPMï¼‰
  - æ‰¹é‡è¯·æ±‚ä¼˜åŒ–

#### `OllamaClient` (`graphgen/models/llm/ollama_client.py`)
- **ç”¨é€”**ï¼šå°è£…æœ¬åœ° Ollama æ¨¡å‹è°ƒç”¨

#### `BatchLLMWrapper` (`graphgen/models/llm/batch_llm_wrapper.py`)
- **ç”¨é€”**ï¼šæ‰¹é‡è¯·æ±‚åŒ…è£…å™¨ï¼Œä¼˜åŒ– LLM è°ƒç”¨
- **åŠŸèƒ½**ï¼š
  - æ‰¹é‡è¯·æ±‚åˆå¹¶
  - è¯·æ±‚ç¼“å­˜
  - è‡ªé€‚åº”æ‰¹å¤„ç†å¤§å°

### 4. ç”Ÿæˆå™¨ï¼ˆGeneratorsï¼‰

#### `AtomicGenerator` (`graphgen/models/generator/atomic_generator.py`)
- **ç”¨é€”**ï¼šç”ŸæˆåŸå­é—®ç­”å¯¹ï¼ˆå•ä¸ªäº‹å®ï¼‰
- **ç‰¹ç‚¹**ï¼šé—®é¢˜ç®€å•ç›´æ¥ï¼Œç­”æ¡ˆç®€çŸ­

#### `AggregatedGenerator` (`graphgen/models/generator/aggregated_generator.py`)
- **ç”¨é€”**ï¼šç”Ÿæˆèšåˆé—®ç­”å¯¹ï¼ˆå¤šä¸ªç›¸å…³äº‹å®ï¼‰
- **ç‰¹ç‚¹**ï¼šé—®é¢˜æ¶‰åŠå¤šä¸ªå®ä½“/å…³ç³»

#### `MultiHopGenerator` (`graphgen/models/generator/multi_hop_generator.py`)
- **ç”¨é€”**ï¼šç”Ÿæˆå¤šè·³é—®ç­”å¯¹ï¼ˆéœ€è¦æ¨ç†è·¯å¾„ï¼‰
- **ç‰¹ç‚¹**ï¼šé—®é¢˜éœ€è¦å¤šæ­¥æ¨ç†æ‰èƒ½å›ç­”

#### `CoTGenerator` (`graphgen/models/generator/cot_generator.py`)
- **ç”¨é€”**ï¼šç”Ÿæˆé“¾å¼æ€è€ƒé—®ç­”å¯¹
- **ç‰¹ç‚¹**ï¼šç­”æ¡ˆåŒ…å«æ¨ç†è¿‡ç¨‹

### 5. åˆ†åŒºå™¨ï¼ˆPartitionersï¼‰

#### `ECEPartitioner` (`graphgen/models/partitioner/ece_partitioner.py`)
- **ç”¨é€”**ï¼šåŸºäºé¢„æœŸæ ¡å‡†è¯¯å·®çš„åˆ†åŒº
- **ç‰¹ç‚¹**ï¼šä¼˜å…ˆé€‰æ‹©çŸ¥è¯†ç›²ç‚¹ï¼ˆç†è§£æŸå¤±é«˜çš„åŒºåŸŸï¼‰

#### `BFSPartitioner` (`graphgen/models/partitioner/bfs_partitioner.py`)
- **ç”¨é€”**ï¼šå¹¿åº¦ä¼˜å…ˆæœç´¢åˆ†åŒº
- **ç‰¹ç‚¹**ï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œé€å±‚æ‰©å±•

#### `DFSPartitioner` (`graphgen/models/partitioner/dfs_partitioner.py`)
- **ç”¨é€”**ï¼šæ·±åº¦ä¼˜å…ˆæœç´¢åˆ†åŒº
- **ç‰¹ç‚¹**ï¼šæ·±åº¦ä¼˜å…ˆéå†å›¾

#### `LeidenPartitioner` (`graphgen/models/partitioner/leiden_partitioner.py`)
- **ç”¨é€”**ï¼šåŸºäº Leiden ç®—æ³•çš„ç¤¾åŒºæ£€æµ‹åˆ†åŒº
- **ç‰¹ç‚¹**ï¼šè¯†åˆ«å›¾ä¸­çš„ç¤¾åŒºç»“æ„

### 6. åç«¯æœåŠ¡æ¨¡å—

#### `TaskProcessor` (`backend/core/task_processor.py`)
- **èŒè´£**ï¼šå¤„ç† KGE-Gen ä»»åŠ¡çš„æ‰§è¡Œ
- **æµç¨‹**ï¼š
  1. åˆå§‹åŒ– KGE-Gen å®ä¾‹
  2. æ‰§è¡ŒçŸ¥è¯†æ„å»º
  3. æ‰§è¡Œç†è§£è¯„ä¼°ï¼ˆå¯é€‰ï¼‰
  4. æ‰§è¡Œ QA ç”Ÿæˆ
  5. ä¿å­˜ç»“æœå¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€

#### `TaskService` (`backend/services/task_service.py`)
- **èŒè´£**ï¼šä»»åŠ¡ç®¡ç†æœåŠ¡
- **åŠŸèƒ½**ï¼šåˆ›å»ºä»»åŠ¡ã€æŸ¥è¯¢ä»»åŠ¡ã€æ›´æ–°ä»»åŠ¡çŠ¶æ€

#### `ReviewService` (`backend/services/review_service.py`)
- **èŒè´£**ï¼šæ•°æ®å®¡æ ¸æœåŠ¡
- **åŠŸèƒ½**ï¼šäººå·¥å®¡æ ¸ã€æ‰¹é‡å®¡æ ¸ã€å®¡æ ¸ç»Ÿè®¡

#### `AuthService` (`backend/services/auth_service.py`)
- **èŒè´£**ï¼šç”¨æˆ·è®¤è¯æœåŠ¡
- **åŠŸèƒ½**ï¼šç”¨æˆ·ç™»å½•ã€Token ç”Ÿæˆã€æƒé™éªŒè¯

---

## ä»£ç ç»“æ„

### é¡¹ç›®ç›®å½•ç»“æ„

```
KGE-Gen/
â”œâ”€â”€ backend/              # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ api/              # API è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ core/             # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ schemas.py        # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ app.py            # FastAPI åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ frontend/             # Vue 3 å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/          # API è°ƒç”¨å°è£…
â”‚   â”‚   â”œâ”€â”€ views/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/       # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ router/       # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ graphgen/             # KGE-Gen æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ bases/            # åŸºç¡€ç±»å’Œæ¥å£
â”‚   â”œâ”€â”€ models/           # æ¨¡å‹å®ç°
â”‚   â”‚   â”œâ”€â”€ generator/    # ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ partitioner/ # åˆ†åŒºå™¨
â”‚   â”‚   â”œâ”€â”€ kg_builder/   # çŸ¥è¯†å›¾è°±æ„å»ºå™¨
â”‚   â”‚   â”œâ”€â”€ llm/          # LLM å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ storage/      # å­˜å‚¨ç³»ç»Ÿ
â”‚   â”œâ”€â”€ operators/        # æ“ä½œç¬¦ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ build_kg/     # çŸ¥è¯†æ„å»º
â”‚   â”‚   â”œâ”€â”€ generate/     # QA ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ partition/    # å›¾åˆ†åŒº
â”‚   â”‚   â””â”€â”€ split/        # æ–‡æ¡£åˆ†å‰²
â”‚   â”œâ”€â”€ templates/        # æç¤ºæ¨¡æ¿
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ graphgen.py       # KGE-Gen æ ¸å¿ƒç±»
â”‚   â””â”€â”€ generate.py       # CLI å…¥å£
â”‚
â”œâ”€â”€ webui/                # Gradio Web UI
â”‚   â”œâ”€â”€ app.py            # Gradio åº”ç”¨
â”‚   â””â”€â”€ task_processor.py # ä»»åŠ¡å¤„ç†
â”‚
â”œâ”€â”€ batch_process/        # æ‰¹é‡å¤„ç†è„šæœ¬
â”œâ”€â”€ docs/                 # æ–‡æ¡£
â”œâ”€â”€ scripts/              # å·¥å…·è„šæœ¬
â””â”€â”€ resources/            # èµ„æºæ–‡ä»¶
```

### å…³é”®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `graphgen/graphgen.py` | KGE-Gen æ ¸å¿ƒç±»ï¼ŒåŒ…å«ä¸»è¦å·¥ä½œæµç¨‹ |
| `graphgen/generate.py` | CLI å…¥å£ï¼Œå‘½ä»¤è¡Œå·¥å…·çš„ä¸»å‡½æ•° |
| `backend/app.py` | FastAPI åº”ç”¨å…¥å£ |
| `backend/core/task_processor.py` | ä»»åŠ¡å¤„ç†å™¨ï¼Œæ‰§è¡Œ KGE-Gen ä»»åŠ¡ |
| `graphgen/operators/generate/generate_qas.py` | QA ç”Ÿæˆçš„æ ¸å¿ƒé€»è¾‘ |
| `graphgen/operators/build_kg/build_text_kg.py` | æ–‡æœ¬çŸ¥è¯†å›¾è°±æ„å»º |
| `graphgen/operators/partition/partition_kg.py` | å›¾åˆ†åŒºé€»è¾‘ |
| `graphgen/models/generator/` | å„ç§ç”Ÿæˆå™¨å®ç° |
| `graphgen/models/partitioner/` | å„ç§åˆ†åŒºå™¨å®ç° |

---

## å…³é”®æ¦‚å¿µ

### 1. Chunkï¼ˆæ–‡æ¡£ç‰‡æ®µï¼‰

**å®šä¹‰**ï¼šå°†é•¿æ–‡æ¡£åˆ†å‰²åå¾—åˆ°çš„å°ç‰‡æ®µã€‚

**æ•°æ®ç»“æ„**ï¼š
```python
@dataclass
class Chunk:
    id: str              # ç‰‡æ®µå”¯ä¸€æ ‡è¯†
    content: str         # ç‰‡æ®µå†…å®¹
    type: str            # ç‰‡æ®µç±»å‹ï¼ˆtext/imageç­‰ï¼‰
    metadata: dict       # å…ƒæ•°æ®
```

**ç”¨é€”**ï¼š
- ä½œä¸ºå®ä½“/å…³ç³»æå–çš„è¾“å…¥å•ä½
- å­˜å‚¨åŸå§‹æ–‡æ¡£çš„ç‰‡æ®µä¿¡æ¯
- åœ¨ç”Ÿæˆ QA æ—¶æä¾›ä¸Šä¸‹æ–‡

### 2. çŸ¥è¯†å›¾è°±ï¼ˆKnowledge Graphï¼‰

**å®šä¹‰**ï¼šç”±èŠ‚ç‚¹ï¼ˆå®ä½“ï¼‰å’Œè¾¹ï¼ˆå…³ç³»ï¼‰ç»„æˆçš„å›¾ç»“æ„ã€‚

**èŠ‚ç‚¹ï¼ˆNodeï¼‰**ï¼š
- è¡¨ç¤ºå®ä½“ï¼ˆå¦‚ï¼šäººç‰©ã€åœ°ç‚¹ã€æ¦‚å¿µç­‰ï¼‰
- åŒ…å«å±æ€§ï¼š`name`ï¼ˆåç§°ï¼‰ã€`description`ï¼ˆæè¿°ï¼‰ã€`entity_type`ï¼ˆç±»å‹ï¼‰ç­‰

**è¾¹ï¼ˆEdgeï¼‰**ï¼š
- è¡¨ç¤ºå®ä½“ä¹‹é—´çš„å…³ç³»
- åŒ…å«å±æ€§ï¼š`source`ï¼ˆæºèŠ‚ç‚¹ï¼‰ã€`target`ï¼ˆç›®æ ‡èŠ‚ç‚¹ï¼‰ã€`description`ï¼ˆå…³ç³»æè¿°ï¼‰ç­‰

**å­˜å‚¨**ï¼šä½¿ç”¨ `NetworkXStorage`ï¼Œåº•å±‚åŸºäº NetworkX å›¾åº“ã€‚

### 3. Batchï¼ˆæ‰¹æ¬¡ï¼‰

**å®šä¹‰**ï¼šå›¾åˆ†åŒºåå¾—åˆ°çš„å­å›¾ï¼Œç”¨äº QA ç”Ÿæˆã€‚

**ç»“æ„**ï¼š
```python
batch = (
    nodes,    # [(node_id, node_data), ...]
    edges     # [(source, target, edge_data), ...]
)
```

**ç”¨é€”**ï¼š
- ä½œä¸º QA ç”Ÿæˆçš„è¾“å…¥å•ä½
- æ¯ä¸ªæ‰¹æ¬¡å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ª QA å¯¹

### 4. ç”Ÿæˆæ¨¡å¼ï¼ˆGeneration Modeï¼‰

**atomicï¼ˆåŸå­æ¨¡å¼ï¼‰**ï¼š
- ç”Ÿæˆç®€å•çš„å•äº‹å®é—®ç­”å¯¹
- é—®é¢˜ç›´æ¥ï¼Œç­”æ¡ˆç®€çŸ­
- ç¤ºä¾‹ï¼šQ: "åŒ—äº¬æ˜¯å“ªä¸ªå›½å®¶çš„é¦–éƒ½ï¼Ÿ" A: "ä¸­å›½"

**aggregatedï¼ˆèšåˆæ¨¡å¼ï¼‰**ï¼š
- ç”Ÿæˆæ¶‰åŠå¤šä¸ªç›¸å…³äº‹å®çš„é—®ç­”å¯¹
- é—®é¢˜å¯èƒ½æ¶‰åŠå¤šä¸ªå®ä½“/å…³ç³»
- ç¤ºä¾‹ï¼šQ: "ä»‹ç»åŒ—äº¬çš„å†å²å’Œåœ°ç†ä½ç½®" A: "..."

**multi_hopï¼ˆå¤šè·³æ¨¡å¼ï¼‰**ï¼š
- ç”Ÿæˆéœ€è¦å¤šæ­¥æ¨ç†çš„é—®ç­”å¯¹
- é—®é¢˜éœ€è¦æ²¿ç€çŸ¥è¯†å›¾è°±çš„å¤šæ¡è¾¹è¿›è¡Œæ¨ç†
- ç¤ºä¾‹ï¼šQ: "A å’Œ C æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"ï¼ˆéœ€è¦å…ˆæ‰¾åˆ° Aâ†’Bï¼Œå†æ‰¾åˆ° Bâ†’Cï¼‰

**cotï¼ˆé“¾å¼æ€è€ƒæ¨¡å¼ï¼‰**ï¼š
- ç”ŸæˆåŒ…å«æ¨ç†è¿‡ç¨‹çš„é—®ç­”å¯¹
- ç­”æ¡ˆä¼šå±•ç¤ºæ¨ç†æ­¥éª¤
- ç¤ºä¾‹ï¼šQ: "..." A: "é¦–å…ˆ...ï¼Œç„¶å...ï¼Œå› æ­¤..."

### 5. è¾“å‡ºæ ¼å¼ï¼ˆOutput Formatï¼‰

**Alpaca æ ¼å¼**ï¼š
```json
{
  "instruction": "é—®é¢˜",
  "input": "",
  "output": "ç­”æ¡ˆ"
}
```

**ShareGPT æ ¼å¼**ï¼š
```json
{
  "conversations": [
    {"from": "human", "value": "é—®é¢˜"},
    {"from": "gpt", "value": "ç­”æ¡ˆ"}
  ]
}
```

**ChatML æ ¼å¼**ï¼š
```json
{
  "messages": [
    {"role": "user", "content": "é—®é¢˜"},
    {"role": "assistant", "content": "ç­”æ¡ˆ"}
  ]
}
```

---

## æ•°æ®æµ

### å®Œæ•´æ•°æ®æµç¤ºä¾‹

```
1. ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
   â””â”€> backend/services/file_service.py
       â””â”€> ä¿å­˜åˆ° cache/uploads/

2. åˆ›å»ºä»»åŠ¡
   â””â”€> backend/api/endpoints.py::create_task()
       â””â”€> backend/services/task_service.py
           â””â”€> ä»»åŠ¡ä¿¡æ¯ä¿å­˜åˆ° tasks/tasks.json

3. æ‰§è¡Œä»»åŠ¡
   â””â”€> backend/core/task_processor.py::process_task()
       â””â”€> åˆå§‹åŒ– KGE-Gen å®ä¾‹
           â””â”€> graphgen/graphgen.py::KGE-Gen()

4. çŸ¥è¯†æ„å»º
   â””â”€> KGE-Gen.insert()
       â”œâ”€> è¯»å–æ–‡æ¡£ (operators/read/read_files.py)
       â”œâ”€> åˆ†å‰²æ–‡æ¡£ (operators/split/split_chunks.py)
       â”‚   â””â”€> ä¿å­˜åˆ° chunks_storage (JsonKVStorage)
       â””â”€> æå–å®ä½“/å…³ç³» (operators/build_kg/build_text_kg.py)
           â””â”€> ä¿å­˜åˆ° graph_storage (NetworkXStorage)

5. ç†è§£è¯„ä¼°ï¼ˆå¯é€‰ï¼‰
   â””â”€> KGE-Gen.quiz_and_judge()
       â”œâ”€> ç”Ÿæˆè¯­ä¹‰å˜ä½“ (operators/quiz.py)
       â””â”€> è¯„ä¼°ç½®ä¿¡åº¦ (operators/judge.py)

6. QA ç”Ÿæˆ
   â””â”€> KGE-Gen.generate()
       â”œâ”€> å›¾åˆ†åŒº (operators/partition/partition_kg.py)
       â”‚   â””â”€> ç”Ÿæˆæ‰¹æ¬¡åˆ—è¡¨
       â””â”€> ç”Ÿæˆ QA å¯¹ (operators/generate/generate_qas.py)
           â”œâ”€> é€‰æ‹©ç”Ÿæˆå™¨ (models/generator/)
           â”œâ”€> è°ƒç”¨ LLM ç”Ÿæˆ
           â””â”€> æ ¼å¼åŒ–è¾“å‡º
               â””â”€> ä¿å­˜åˆ° qa_storage (JsonListStorage)

7. ä¿å­˜ç»“æœ
   â””â”€> backend/core/task_processor.py
       â””â”€> ä¿å­˜åˆ° tasks/outputs/{task_id}.json

8. æ•°æ®å®¡æ ¸ï¼ˆå¯é€‰ï¼‰
   â””â”€> backend/services/review_service.py
       â””â”€> å®¡æ ¸ç»“æœä¿å­˜åˆ° tasks/reviews/
```

### å­˜å‚¨æ•°æ®æµ

```
åŸå§‹æ–‡æ¡£
    â”‚
    â–¼
full_docs_storage (JsonKVStorage)
    â”‚
    â–¼
chunks_storage (JsonKVStorage)
    â”‚
    â–¼
graph_storage (NetworkXStorage)
    â”‚
    â–¼
åˆ†åŒºåçš„æ‰¹æ¬¡ (batches)
    â”‚
    â–¼
qa_storage (JsonListStorage)
    â”‚
    â–¼
æœ€ç»ˆè¾“å‡ºæ–‡ä»¶ (tasks/outputs/{task_id}.json)
```

---

## å¿«é€Ÿä¸Šæ‰‹

### 1. ç†è§£æ ¸å¿ƒæµç¨‹

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºé˜…è¯»ä»£ç ï¼š

1. **å…¥å£ç‚¹**ï¼š
   - CLIï¼š`graphgen/generate.py::main()`
   - Web APIï¼š`backend/main.py` â†’ `backend/app.py` â†’ `backend/core/task_processor.py`

2. **æ ¸å¿ƒç±»**ï¼š
   - `graphgen/graphgen.py::KGE-Gen`ï¼šç†è§£ä¸»è¦æ–¹æ³•å’Œæµç¨‹

3. **å…³é”®æ“ä½œ**ï¼š
   - `graphgen/operators/build_kg/build_text_kg.py`ï¼šçŸ¥è¯†æ„å»º
   - `graphgen/operators/partition/partition_kg.py`ï¼šå›¾åˆ†åŒº
   - `graphgen/operators/generate/generate_qas.py`ï¼šQA ç”Ÿæˆ

4. **ç”Ÿæˆå™¨**ï¼š
   - `graphgen/models/generator/atomic_generator.py`ï¼šç†è§£ç”Ÿæˆé€»è¾‘

### 2. è°ƒè¯•æŠ€å·§

- **æŸ¥çœ‹æ—¥å¿—**ï¼šä»»åŠ¡æ‰§è¡Œæ—¥å¿—ä¿å­˜åœ¨ `cache/{task_id}/logs/`
- **æ£€æŸ¥å­˜å‚¨**ï¼šçŸ¥è¯†å›¾è°±å’Œ QA æ•°æ®ä¿å­˜åœ¨ `cache/{task_id}/` ç›®å½•
- **API æ–‡æ¡£**ï¼šè®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹ API æ–‡æ¡£

### 3. å¸¸è§ä¿®æ”¹åœºæ™¯

**ä¿®æ”¹ç”Ÿæˆæ¨¡å¼**ï¼š
- ç¼–è¾‘ `graphgen/models/generator/` ä¸‹çš„ç”Ÿæˆå™¨ç±»
- ä¿®æ”¹æç¤ºæ¨¡æ¿ï¼š`graphgen/templates/generation/`

**æ·»åŠ æ–°çš„åˆ†åŒºæ–¹æ³•**ï¼š
- åœ¨ `graphgen/models/partitioner/` ä¸‹åˆ›å»ºæ–°çš„åˆ†åŒºå™¨ç±»
- å®ç° `BasePartitioner` æ¥å£
- åœ¨ `graphgen/operators/partition/partition_kg.py` ä¸­æ³¨å†Œ

**ä¿®æ”¹è¾“å‡ºæ ¼å¼**ï¼š
- ç¼–è¾‘ç”Ÿæˆå™¨çš„ `format_generation_results()` æ–¹æ³•
- å‚è€ƒï¼š`graphgen/models/generator/atomic_generator.py::format_generation_results()`

**ä¼˜åŒ– LLM è°ƒç”¨**ï¼š
- æŸ¥çœ‹ `graphgen/models/llm/batch_llm_wrapper.py`ï¼šæ‰¹é‡è¯·æ±‚ä¼˜åŒ–
- æŸ¥çœ‹ `graphgen/utils/batch_request_manager.py`ï¼šæ‰¹é‡è¯·æ±‚ç®¡ç†

---

## æ€»ç»“

KGE-Gen çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

1. **ä»æ–‡æ¡£åˆ°çŸ¥è¯†å›¾è°±**ï¼šé€šè¿‡ LLM æå–å®ä½“å’Œå…³ç³»ï¼Œæ„å»ºç»“æ„åŒ–çŸ¥è¯†å›¾è°±
2. **ä»çŸ¥è¯†å›¾è°±åˆ° QA å¯¹**ï¼šåŸºäºçŸ¥è¯†å›¾è°±çš„å­å›¾ï¼Œç”Ÿæˆé«˜è´¨é‡çš„é—®ç­”å¯¹
3. **å¤šç§ç”Ÿæˆæ¨¡å¼**ï¼šæ”¯æŒä¸åŒå¤æ‚åº¦çš„é—®ç­”å¯¹ï¼Œæ»¡è¶³ä¸åŒè®­ç»ƒéœ€æ±‚

**å…³é”®è®¾è®¡åŸåˆ™**ï¼š
- **æ¨¡å—åŒ–**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨å¼‚æ­¥ I/O æé«˜æ€§èƒ½
- **å¯é…ç½®**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è¡Œä¸º
- **å¯æ‰©å±•**ï¼šæ˜“äºæ·»åŠ æ–°çš„ç”Ÿæˆå™¨ã€åˆ†åŒºå™¨ç­‰

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ å¿«é€Ÿç†è§£ KGE-Gen çš„ä»£ç æ¶æ„å’Œæ ¸å¿ƒé€»è¾‘ï¼å¦‚æœ‰ç–‘é—®ï¼Œå»ºè®®æŸ¥çœ‹å…·ä½“çš„ä»£ç å®ç°å’Œæ³¨é‡Šã€‚

